
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dependency Injection with Scala - tysonjh</title>
  <meta name="author" content="tysonjh">
  
  
  <meta name="description" content="Discussion and example of two differing dependency injection design patterns in Scala - Cake & Macwire" />

  
  <meta name="keywords" content="Scala, Design Patterns, Dependency Injection, Cake, Macwire">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tysonjh.com/blog/2014/01/19/dependency-injection-with-scala">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="tysonjh" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30501057-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">tysonjh</a></h1>
  
    <h2>making mistakes everyday</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tysonjh.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Dependency Injection With Scala</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-19T11:56:43-05:00" pubdate data-updated="true">Jan 19<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Dependency injection (DI) is a design pattern that has been described in depth both in print and on the web, my goal is
to illustrate an example of how I used it in practice with satisfying results. If you would like to learn more about DI,
do what I did and look to an expert in your area of interest, <a href="http://jonasboner.com/2008/10/06/real-world-scala-dependency-injection-di/">Real-World Scala: Dependency Injection (DI)</a> by Jonas Bonér is a great read, in fact I question the worth of this post after reading it again.</p>

<p><a href="http://stackoverflow.com/a/1638961/1274818">John Munsch</a> provides an elegant and nostalgic explanation,</p>

<blockquote><p>When you go and get things out of the refrigerator for yourself, you can cause problems. You might leave the door open, you might get something Mommy or Daddy doesn&rsquo;t want you to have. You might even be looking for something we don&rsquo;t even have or which has expired.</p>

<p>What you should be doing is stating a need, &ldquo;I need something to drink with lunch,&rdquo; and then we will make sure you have something when you sit down to eat.</p></blockquote>

<h2>Example Use Case: NOSQL data cleanup</h2>

<ul>
<li><a href="http://github.com/tysonjh/">Source using Cake Pattern</a></li>
<li><a href="http://github.com/tysonjh/">Source using Macwire</a></li>
</ul>


<h4>Description</h4>

<p>There is a data issue in a production NOSQL database, we need to clean it up. Anything touching data in production makes me sweat. Generally with NOSQL you design your schema to support specific queries since joins must be done by the application or through creative indexing. When an unexpected need to join unrelated data arises things get interesting. So we must proceed with caution.</p>

<h4>Triggers</h4>

<p>An administrator will execute the script from the command line.</p>

<h4>Actors</h4>

<ol>
<li>A database access object that provides a domain specific view into our database</li>
<li>A database client library that provides access to the operations of a database</li>
<li>A command line interface for controlling the flow of the application</li>
</ol>


<h4>Preconditions</h4>

<ol>
<li>The database is available</li>
<li>The data model is a key/value store that <em>for all keys:K there exists a value:V where K:String &ndash;> V:Int</em></li>
</ol>


<h4>Goals</h4>

<ol>
<li>All keys are capitalized and trimmed of white space</li>
<li>The lowest value of any keys that differ only by case and whitespace are kept, all others are removed</li>
</ol>


<h3>Design Considerations</h3>

<p>You should be screaming TDD right now. This means unit tests and lots of them, which means we need a mock/stub implementation of our database. I&rsquo;ve written two different implementations of the DI pattern, the first using Cake as discussed by Jonas Bonér and the next using Macwire. The source files for both examples are provided as links above. I&rsquo;m providing a Macwire example because I wanted to try it out, in practice I used the cake pattern in this instance.</p>

<h3>Implementation Highlights</h3>

<p>Here is a snippet of the <code>DatabaseComponent</code> trait we use for accessing the database,</p>

<blockquote><p>insert DatabaseComponent snippet</p></blockquote>

<p>Notice we leave the <code>client</code> value as an abstract member, of type <code>DatabaseClient</code> which is a nested trait. This is what we will be using to inject different implementations of the <code>client</code>. The nested trait simply cleans up the namespace so all of those methods (get, set, exist, delete) are only visible from within the <code>DatabaseClient</code> object as we would expect, it also provides us with a greater flexibility for where we instantiate our <code>client</code> object.</p>

<h4>Components</h4>

<p>Below are the three implementations of the <code>DatabaseComponent</code>, the real <code>Database</code>, the write simulated <code>DatabaseWriteSimulator</code> and the test <code>TestDatabase</code> respectively</p>

<blockquote><p>database snippet</p></blockquote>

<p>The <code>DatabaseWriteSimulator</code> turned out to be quite useful and simply prints operations that alter the database instead of actually performing them. It was a nice way to test the script on real data in an environment.</p>

<blockquote><p>simulator snippet</p></blockquote>

<p>The <code>TestDatabase</code> is very similar to the <code>Database</code> trait which fully implements a <code>DatabaseComponent</code>, it could easily be replaced using a mocking framework.</p>

<blockquote><p>test snippet</p></blockquote>

<h4>Wiring Components with Modules</h4>

<p>Modules are one way to wire the various traits together as required by DI. This really lets me visualize the whole cake pattern, I like to picture the class names as the icing and Scala symbols like <code>class</code>, <code>extends</code> and <code>with</code> as the cake.</p>

<p><code>object Production extends ProductDaoComponent with Database</code></p>

<p>Stack those words up starting at the bottom with <code>object</code>, moving right ending with <code>Database</code> on top. Methods and members at the bottom of the cake get overridden or implemented by things higher up in the cake. As long as you have no unimplemented methods or instantiated members you&rsquo;ve got a full cake!</p>

<blockquote><p>insert cake image</p></blockquote>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">tysonjh</span></span>

      








  


<time datetime="2014-01-19T11:56:43-05:00" pubdate data-updated="true">Jan 19<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dependency-injection/'>Dependency Injection</a>, <a class='category' href='/blog/categories/design-patterns/'>Design Patterns</a>, <a class='category' href='/blog/categories/scala/'>Scala</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tysonjh.com/blog/2014/01/19/dependency-injection-with-scala/" data-via="tysonjh" data-counturl="http://tysonjh.com/blog/2014/01/19/dependency-injection-with-scala/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/01/18/hello-octopress/" title="Previous Post: Hello Octopress">&laquo; Hello Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/01/29/scala-macros-and-quasiquotes/" title="Next Post: Feature Toggling using Scala Quasiquote Macros">Feature Toggling using Scala Quasiquote Macros &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/03/08/scala-delayedinit-trait-explored/">Scala DelayedInit Trait Explored</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/09/scala-macros-accessing-case-class-parameters/">Scala Macros: accessing case class parameters</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/29/scala-macros-and-quasiquotes/">Feature Toggling using Scala Quasiquote Macros</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/19/dependency-injection-with-scala/">Dependency Injection with Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/18/hello-octopress/">Hello Octopress</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tysonjh">@tysonjh</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tysonjh',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/tyson.j.hamilton?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - tysonjh -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tysonjh';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tysonjh.com/blog/2014/01/19/dependency-injection-with-scala/';
        var disqus_url = 'http://tysonjh.com/blog/2014/01/19/dependency-injection-with-scala/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
